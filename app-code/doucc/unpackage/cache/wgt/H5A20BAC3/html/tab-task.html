<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>Hello MUI</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">

		<link rel="stylesheet" href="../css/mui.min.css">
		<link rel="stylesheet" href="../css/main.css">
		<style>
			html,body {
				background-color: #efeff4;
			}
			
			
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav" style="padding-right: 15px;">
			<h1 class="mui-title">我的任务</h1>
		</header>
		<div class="mui-content mui-scroll-wrapper" id="task-box">
			
			<ul id="task-me-list" class="mui-table-view mui-scroll">
		
			    
			</ul>
			
		</div>
	</body>
	<script src="../js/mui.min.js"></script>
	<script src="../js/main.js"></script>
	<script>
		mui.init({
			swipeBack:true, //启用右滑关闭功能
			pullRefresh : {
			    container:"#task-box",//下拉刷新容器标识，querySelector能定位的css选择器均可，比如：id、.class等
			    down : {
			      style:'circle',//必选，下拉刷新样式，目前支持原生5+ ‘circle’ 样式
			      color:'#2BD009', //可选，默认“#2BD009” 下拉刷新控件颜色
			      height:'50px',//可选,默认50px.下拉刷新控件的高度,
			      range:'100px', //可选 默认100px,控件可下拉拖拽的范围
			      offset:'0px', //可选 默认0px,下拉刷新控件的起始位置
			      auto: true,//可选,默认false.首次加载自动上拉刷新一次
			      callback : getTaskList //必选，刷新函数，根据具体业务来编写，比如通过ajax从服务器获取新数据；
			    }
			  }
		});
		
		mui.plusReady(function() {
			var self = plus.webview.currentWebview();  
			var is_back = self.is_back;  
			
			mui.ajax(config.host + 'index.php?s=Task/getMeTask', {
				data: getToken(),
				dataType: 'json', //服务器返回json格式数据
				type: 'post', //HTTP请求类型
				timeout: 10000, //超时时间设置为10秒；
				headers: {
					'Content-Type': 'application/json'
				},
				success: function(data) {
					console.log(data)
					//服务器返回响应，根据响应结果，分析是否登录成功；
					if (data.code == 0) {
						mui.alert(data.msg);
					} else {
						var html = "";
						for (var i in data.data) {	
							var status_name = "进行中",
								type = "warning";
							if(data.data[i].status == 1){
								status_name = "已完成";
								type = "success";
							}
							html += '<li class="mui-table-view-cell c-item">' +
								'<div class="t-info">' +
								'<span>' + data.data[i].name + '</span>' +
								'<div class="mui-progressbar take-process" data-status="' + data.data[i].status + '"><span></span></div></div>' + 
								'<div class="r-right"><span class="mui-badge mui-badge-' + type + '">' +
								status_name + '</span></div></li>';
								
						}
						var tlist = document.getElementById("task-me-list");
						tlist.innerHTML = html;
						setTimeout(function(){
							mui(".take-process").each(function(){
								var num = 20;
								if(this.getAttribute("data-status") == 1){
									num = 100;
								}
								mui(this).progressbar({
									progress: num
								}).show();
							});
						}, 20);
					}
			
				},
				error: function(xhr, type, errorThrown) {
			
				}
			});
			
			
		});
		
		var getTaskList = function(){
			mui.alert("pull");
		};
		
	</script>
</html>